/**
 * Fix all "return const dbPool = getDb();" syntax errors
 * This was incorrectly generated by the update script
 */

const fs = require('fs');
const path = require('path');

const modelsDir = path.join(__dirname, '../models');
const models = fs.readdirSync(modelsDir).filter(file => file.endsWith('.js'));

console.log(`\nðŸ”§ Fixing return const syntax errors in ${models.length} model files...\n`);

let fixedCount = 0;

models.forEach(modelFile => {
  const modelPath = path.join(modelsDir, modelFile);
  let content = fs.readFileSync(modelPath, 'utf8');
  let updated = false;
  
  // Fix pattern: "return const dbPool = getDb();"
  // Replace with: "const dbPool = getDb();\n  return await dbPool.query("
  const pattern = /(\s+)return\s+const\s+dbPool\s+=\s+getDb\(\);/g;
  if (pattern.test(content)) {
    content = content.replace(pattern, (match, indent) => {
      return indent + 'const dbPool = getDb();\n' + indent + 'return await dbPool.query(';
    });
    updated = true;
  }
  
  // Fix pattern: "return\n await dbPool.query("
  // Replace with: "return await dbPool.query("
  const pattern2 = /(\s+)return\s*\n\s+await\s+dbPool\.query\(/g;
  if (pattern2.test(content)) {
    content = content.replace(pattern2, (match, indent) => {
      return indent + 'return await dbPool.query(';
    });
    updated = true;
  }
  
  if (updated) {
    fs.writeFileSync(modelPath, content, 'utf8');
    console.log(`âœ… ${modelFile}`);
    fixedCount++;
  }
});

console.log(`\nâœ… Fixed: ${fixedCount} files`);
console.log(`\nðŸŽ‰ Done!\n`);

